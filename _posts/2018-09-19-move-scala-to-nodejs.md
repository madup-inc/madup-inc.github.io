---
layout: post
title: 스칼라에서 노드JS로 갈아탄 이유
author: Chris
date: 2018-09-19
---

![로고](foo)

매드업은 광고 진행을 위한 기술 솔류션을 개발하는 팀입니다. 
광고주로부터 의뢰을 받아 적절한 곳으로 광고를 보내는 역할을 하고 있지요.
광고는 우리가 모르고 있던 수많은 이해 당사자들의 손을 거쳐 각 개인의 스마트폰으로 전송되고 있답니다.

저도 이러한 광고 산업(저희는 애드테크라고 부릅니다)에 입문한터라 생소하고 신기한것이 많네요.
스마튼폰의 보급으로인해 개인을 식별할 수 있는 데이터가 늘어나는 상황과 효율적인 광고라는 과제가 애드테크 
산업의 매력 포인트라고 생각합니다.

오늘은 광고 진행을 위한 **매드업의 웹 어드민 서비스**를 소개할까 합니다. 
서비스를 이루고 있는 **개발 기술**에 대해서 말이죠. 

## 문제

매드업 어드민은 리엑트와 스칼라 언어로 만든 웹 서비스 입니다. 

리엑트 기반의 프론트엔드는 리덕스, 앤트 디자인, 그래프 라이브러리로 개발하고,
별로로 EC2 인스턴스에 구성한 웹서버에서 호스팅 되고 있었죠.

스칼라 기반의 백엔드는 프론트엔드에게 API를 제공하고 AWS 빈스톡 위에서 구동되고 있는 서비스였습니다.

**'비교적 작은 서비스를 프론트엔드와 백엔드로 나누어 별도 서버로 운영하는게 효율적일까?'**

서비스 구조를 프론트엔드와 백엔드로 나누다 보면 역할까지 분리해서 일하게 됩니다.
부작용이 생길수 있는데 예를 들면 이런 것이죠.
'이 화면의 데이터는 디비의 어떤 테이블에 있는건가요?' 라는 질문에
'그건 백엔드 개발자에게 물어 보세요'라는 답변이 온다는거죠.

**'우리게게 이러한 역할 분리가 필요한가?'**

원작자의 코드를 건네 받았지만 개발 히스토리에 대한 정보가 부족한 개발팀은 코드를 쉽게 건드릴수 없었습니다.
뿐만아니라 스칼라 개발자가 부족한 상황이라 아무나 백엔드 시스템을 개발할수 없었죠.

**'스칼라가 지금도 합리적인 선택일까?'**

## 대안

이러한 문제를 해결하기 몇 가지 기준을 세웠습니다.

**인프라와 코드를 하나로 운영하자**

프론트엔드와 백엔드는 각자의 깃 저장소와 서버로 운영되고 있어서 지금 규모에서는 이득보다는 운영 비용이 
더 많았습니다. 배보다 배꼽이 더 큰 상황이라고 할수 있죠. 하나의 저장소, 하나의 서버로 운영한다면 
적은 인원이 집중할 수 있는 환경이 구성될 것입니다.

**혼자 개발하지 말자**

각 플래폼별로 1인인 개발하는 시스템은 서비스 전반을 파악할수 없다는 문제가 있었죠. 
뿐만 아니라 함께 일하는 협업의 모습을 갖기도 어려웠습니다. 
프론트엔드와 백엔드를 함께 개발할수 있는 환경을 만드는 것이 팀으로 일하는 더 좋은 방법입니다.

**좀 더 보편적인 기술을 사용하자**

저희는 스칼라 코드를 읽을 줄 아는 사람이 부족합니다. 게다가 개발자 채용도 어렵죠. 

![](/images/2018/09/19/stackoverflow-developer-servey-results-2018.jpg)
<small>- [Stackoverflow Developer Servey Results 2018](https://insights.stackoverflow.com/survey/2018/#technology-programming-scripting-and-markup-languages) 참고 -</small>

자바스크립트를 선택했습니다. 정도의 차이는 있지만 팀원 모두가 노드JS에 대한 경험이 있고, 최소한 
코드를 읽을 수 있는 역량은 갖추고 있는 상황입니다.

개발 환경도 중요했는데 무거운 자바 코드를 돌리는 것에 비해 몇 초내에 구동되는 노드 환경이 주어졌습니다.

뿐만아니라 기존에 빈스톡 환경을 그대로 사용할수 있다는 점도 선택의 이유 중 하나입니다.
([Elastic Beanstalk가 지원되는 플랫폼](https://docs.aws.amazon.com/ko_kr/elasticbeanstalk/latest/dg/concepts.platforms.html) 참고)

## 해결 

// 점진적 개발, 배포 
// 깃헙 플로우, 협업 

백엔드 API 서비스를 스칼라에서 노드JS로 옮기기로 결정했습니다. 

분리된 **저장소와 운영 서버를 단일화** 하는 것이 먼저였습니다. 
익스프레스 프레임웍을 기반으로 리액트 어플리케이션을 정적 파일로 처리하는 구조로 합쳤습니다.
그리고 하나의 빈스톡에서 프론트엔드와 백앤드를 호스팅하도록 했습니다.

신규 서비스는 여전히 스칼라로 만든 백엔드 API를 호출하고 있는 상태입니다. 
운영중인 서비스를 중단없이 기술 이관하기 위해서는 **점진적으로 노드JS로 개발**하자는 전략을 세웠습니다.
개발과 운영 두 가지를 동시에 진행할수 있었던건 프론트엔드의 API 호출이 하나의 모듈에서 처리도고 있는 현 구조 덕분이었습니다.

이 API 담당 모듈 앞에 노드JS로 만든 신규 API와 스칼라로 만든 현행 API를 선택하는 역할을 하는 `apiUrlAdaptor`라는 녀석을 붙였습니다.
피처토글도...
![](구조도)

....
모든 API를 노드로 이관한 뒤 이 모듈을 제거하고 기존 스칼라 코드를 안전하게 페이드 아웃할수 있었습니다.

이러한 구조에서는 하나의 코드를 여러명이 동시에 봐야하는 상황으로 변했습니다.
다른 사람의 코드를 봐야하고 내가 작성하는 코드를 남이 봐야하는 상황이죠. 
깃헙을 사용하는 저희는 **[깃헙 플로우](?)를 따라 협업**했습니다. 
이슈 기반으로 업무를 나누고 PR로 코들 리뷰하는 방식인데 비교적 쉽게 적응할 수 있었습니다.
좀 더 업무 플로우를 정리한뒤 이부분은 따로 다뤄 볼 생각입니다.

## 결과 

10주간 진행된 이 프로젝트로 인해 몇 가지 실질적인 이득을 얻었습니다. 

**인프라 리스소를 절약했습니다**.
프론트엔드와 백엔드 별로 운영하는 코드 저장소와 서비스 서버를 단일화 했기 때문이죠. 
운영 모니터링도 하나로 집중할수 있어서 비교적 업무 집중도가 향상되었습니다.

**기술 부채를 갚았습니다**. 
기술의 문턱이 낮아지고 누구나 서비스 코드를 다룰수 있게 되었습니다. 
뿐만아니라 채용도 나아졌습니다.

**같이 일합니다**. 
서비스를 합치고 같이 일하는 방법을 배우기 시작했습니다. 
서로의 코드를 살펴보고 리뷰어를 배려하는 공손한 코드를 만들기 시작했죠. 

단순히 기술 스택을 변경했다고 해서 개발이 끝은 아니죠. 
앞으로 만들어 나갈 애드테크 서비스 개발에 대한 준비 작업을 한것이죠.
저희는 덮밥의 밥을 만드는 과정이라고 말합니다.
이제...